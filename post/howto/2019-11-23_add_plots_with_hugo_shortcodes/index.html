<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.59.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>Add Plots With Hugo Shortcodes - Plotly&nbsp;&ndash;&nbsp;MetalBlueberry</title><link rel="stylesheet" href="/css/core.min.97dca4f10b4a76a5c62d6c5855e9eaab3b083ba20b6e4059f24dc20a8bb331c418ecdfd5449a29ef5333ebc2c64b286b.css" integrity="sha384-l9yk8QtKdqXGLWxYVenqqzsIO6ILbkBZ8k3CCouzMcQY7N/VRJop71Mz68LGSyhr"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Add Plots With Hugo Shortcodes - Plotly"/>
<meta name="twitter:description" content="Plotly is my favourite tool to create plots for a lot of reasons. One is that you can create plots with javascript and create interactive graphs. I&rsquo;m going to show you how to create a shortcode to add plots to your hugo static site."/>

<meta property="og:title" content="Add Plots With Hugo Shortcodes - Plotly" />
<meta property="og:description" content="Plotly is my favourite tool to create plots for a lot of reasons. One is that you can create plots with javascript and create interactive graphs. I&rsquo;m going to show you how to create a shortcode to add plots to your hugo static site." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://metalblueberry.github.io/post/howto/2019-11-23_add_plots_with_hugo_shortcodes/" />
<meta property="article:published_time" content="2019-12-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-04-10T11:39:35+02:00" />

<meta name="author" content="MetalBlueberry">

<script src="https://cdn.plot.ly/plotly-1.50.0.min.js"></script>
<body>
    <div class="base-body"><section id="header" class="site header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><img class="site logo" src="/android-chrome-512x512.png" alt /><span class="site name">MetalBlueberry</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/about">About</a><a class="nav item" href="/social">Follow me</a></nav></div></span></div><div class="site slogan"><span class="title">A passionate programmer</span></div></section><div id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Add Plots With Hugo Shortcodes - Plotly</h1><p class="article date">Friday, December 6, 2019<span class="lastmod"> • edited Friday, April 10, 2020</span></p></section><article class="article markdown-body"><p>Plotly is my favourite tool to create plots for a lot of reasons. One is that you can create plots with javascript and create interactive graphs. I&rsquo;m going to show you how to create a shortcode to add plots to your hugo static site.</p>

<h2 id="introduction">Introduction</h2>

<p><a href="https://plot.ly/">Plotly</a> is an open source library to create interactive plots. If you have been involved in dashboard creation or data analytics. probably you already know it.</p>

<p>I like Plotly because it is really easy to create portable and interactive plots that can be shared as a webpage. This solves the typical problem when you want to share a plot created with specific tools. For Excel, you need Excel. For Python Pandas, you need Python. For PowerBI you need a license&hellip; You can always export a PNG image, but this removes the interaction.</p>

<p>In this situation, I would like to display plots in my blog that allow my viewers to interact with the data.</p>

<h2 id="the-code">The code</h2>

<p>The javascript codes are available in the <a href="https://plot.ly/javascript/line-charts/">official documentation</a> and are really simple. The following code will draw a line plot in the html div with id <code>myDiv</code></p>

<pre><code class="language-js">var trace1 = {
  x: [1, 2, 3, 4],
  y: [10, 15, 13, 17],
  type: 'scatter'
};

var trace2 = {
  x: [1, 2, 3, 4],
  y: [16, 5, 11, 9],
  type: 'scatter'
};

var data = [trace1, trace2];

Plotly.newPlot('myDiv', data);
</code></pre>

<p>So we need to create a div with a known id inside the post and also run the necessary js code. This is how the short code looks like.</p>

<pre><code class="language-html">&lt;div class=&quot;figure&quot;&gt;
&lt;div class=&quot;figure-plot&quot; id=&quot;{{ .Get 0 }}&quot;&gt;
	Code could not finish, this are some reasons why this happen.
	- Plot name not defined. The first parameter of the shortcode is the name.
	- There is a syntax error. check browser console.
&lt;/div&gt;
&lt;script&gt;
  function draw(){
	test = document.getElementById(&quot;{{ .Get 0 }}&quot;);
	if (test == null){
		console.log(&quot;The plot name is not defined&quot;)
		return
	}

	fig = null
	{{ .Inner | safeJS }}

	if (!fig) {
		test.innerText = &quot;ERROR: fig variable is not defined&quot;
		return
	}
	test.innerText = null
	Plotly.plot(test ,fig);
  }
  draw()
&lt;/script&gt;
&lt;/div&gt;
</code></pre>

<p>The line 3-5 are to display a default message in the case the shortcode is not used properly and something fails. The function draw finds the div by id and check if it actually exist. This will print an extra log message to the console if fails. Then it defines the <code>fig</code> variable and evaluates the provided code. This code should assign a value to the fig variable or the shortcode will put an error message <code>ERROR: fig variable is not defined</code>. If it&rsquo;s defined, plotly will do it&rsquo;s magic.</p>

<p>This is how the shortcode is used.</p>

<pre><code class="language-js">{{/*% plot plot2 %*/}}
var trace1 = {
  x: [1, 2, 3, 4],
  y: [10, 15, 13, 17],
  type: 'scatter'
};

var trace2 = {
  x: [1, 2, 3, 4],
  y: [16, 5, 11, 9],
  type: 'scatter'
};

data = [trace1, trace2];
fig = {
  data: data
}
{{/*% /plot %*/}}
</code></pre>

<p>And the plot generated</p>

<div class="figure">
<div class="figure-plot" id="plot2">
	Code could not finish, this are some reasons why this happen.
	- Plot name not defined. The first parameter of the shortcode is the name.
	- There is a syntax error. check browser console.
</div>
<script>
  function draw(){
	test = document.getElementById("plot2");
	if (test == null){
		console.log("The plot name is not defined")
		return
	}

	fig = null
	
var trace1 = {
  x: [1, 2, 3, 4],
  y: [10, 15, 13, 17],
  type: 'scatter'
};

var trace2 = {
  x: [1, 2, 3, 4],
  y: [16, 5, 11, 9],
  type: 'scatter'
};

data = [trace1, trace2];
fig = {
  data: data
}


	if (!fig) {
		test.innerText = "ERROR: fig variable is not defined"
		return
	}
	test.innerText = null
	Plotly.plot(test ,fig);
  }
  draw()
</script>
</div>

<p>You may wonder why I&rsquo;m putting the Plotly.plot in the shortcode instead of just allowing the user to put everything in the shortocde body. One reason is to give clear feedback of what is broken. But the most important reason is that this shortcode is intended just to draw plots, not to execute complex javascript. My intention is to use Python to generate the complex structure and then just copy and paste. Here is an example of the plot in the mandelbrot parallel calculation post.</p>

<pre><code class="language-js">{{/* plot figure1 &gt;*/}}
fig = {&quot;data&quot;:[{&quot;x&quot;:[&quot;1024x1024x1&quot;,&quot;512x512x2&quot;,&quot;256x256x4&quot;,&quot;128x128x8&quot;,&quot;64x64x16&quot;,&quot;32x32x32&quot;,&quot;16x16x64&quot;,&quot;8x8x128&quot;,&quot;4x4x256&quot;,&quot;2x2x512&quot;,&quot;1x1x1024&quot;],&quot;y&quot;:[5.319377513,3.730183194,3.492960513,3.416568462,3.406160365,3.404795796,3.401629099,3.403963371,3.406568944,3.403851128,3.401489335],&quot;name&quot;:&quot;1 workers&quot;},{&quot;x&quot;:[&quot;1024x1024x1&quot;,&quot;512x512x2&quot;,&quot;256x256x4&quot;,&quot;128x128x8&quot;,&quot;64x64x16&quot;,&quot;32x32x32&quot;,&quot;16x16x64&quot;,&quot;8x8x128&quot;,&quot;4x4x256&quot;,&quot;2x2x512&quot;,&quot;1x1x1024&quot;],&quot;y&quot;:[5.105426336,2.403512541,1.769243872,1.720678808,1.705878765,1.702246865,1.705907853,1.731687894,1.819791773,1.954560985,3.404077505],&quot;name&quot;:&quot;2 workers&quot;},{&quot;x&quot;:[&quot;1024x1024x1&quot;,&quot;512x512x2&quot;,&quot;256x256x4&quot;,&quot;128x128x8&quot;,&quot;64x64x16&quot;,&quot;32x32x32&quot;,&quot;16x16x64&quot;,&quot;8x8x128&quot;,&quot;4x4x256&quot;,&quot;2x2x512&quot;,&quot;1x1x1024&quot;],&quot;y&quot;:[4.665434148,1.840141806,1.23159353,1.156602142,1.139298289,1.135465838,1.145931396,1.190932724,1.324346159,1.955651422,3.401555276],&quot;name&quot;:&quot;3 workers&quot;},{&quot;x&quot;:[&quot;1024x1024x1&quot;,&quot;512x512x2&quot;,&quot;256x256x4&quot;,&quot;128x128x8&quot;,&quot;64x64x16&quot;,&quot;32x32x32&quot;,&quot;16x16x64&quot;,&quot;8x8x128&quot;,&quot;4x4x256&quot;,&quot;2x2x512&quot;,&quot;1x1x1024&quot;],&quot;y&quot;:[3.277424857,1.508889857,1.000251994,0.877004851,0.855757891,0.851836168,0.859728354,0.902649372,1.012687753,1.955834209,3.404003372],&quot;name&quot;:&quot;4 workers&quot;},{&quot;x&quot;:[&quot;1024x1024x1&quot;,&quot;512x512x2&quot;,&quot;256x256x4&quot;,&quot;128x128x8&quot;,&quot;64x64x16&quot;,&quot;32x32x32&quot;,&quot;16x16x64&quot;,&quot;8x8x128&quot;,&quot;4x4x256&quot;,&quot;2x2x512&quot;,&quot;1x1x1024&quot;],&quot;y&quot;:[2.687810723,1.299930746,0.848919389,0.71687461,0.697146793,0.686797944,0.695021475,0.733307298,0.782258103,1.958691928,3.406197102],&quot;name&quot;:&quot;5 workers&quot;},{&quot;x&quot;:[&quot;1024x1024x1&quot;,&quot;512x512x2&quot;,&quot;256x256x4&quot;,&quot;128x128x8&quot;,&quot;64x64x16&quot;,&quot;32x32x32&quot;,&quot;16x16x64&quot;,&quot;8x8x128&quot;,&quot;4x4x256&quot;,&quot;2x2x512&quot;,&quot;1x1x1024&quot;],&quot;y&quot;:[2.419063112,1.172598442,0.770078822,0.636418239,0.59517132,0.58758251,0.598871324,0.655497364,0.722161112,1.955789037,3.40305645],&quot;name&quot;:&quot;6 workers&quot;},{&quot;x&quot;:[&quot;1024x1024x1&quot;,&quot;512x512x2&quot;,&quot;256x256x4&quot;,&quot;128x128x8&quot;,&quot;64x64x16&quot;,&quot;32x32x32&quot;,&quot;16x16x64&quot;,&quot;8x8x128&quot;,&quot;4x4x256&quot;,&quot;2x2x512&quot;,&quot;1x1x1024&quot;],&quot;y&quot;:[1.991583443,1.033091053,0.712726608,0.605582734,0.578420338,0.577574125,0.580463384,0.652894185,0.691949137,1.970116638,3.452580344],&quot;name&quot;:&quot;7 workers&quot;},{&quot;x&quot;:[&quot;1024x1024x1&quot;,&quot;512x512x2&quot;,&quot;256x256x4&quot;,&quot;128x128x8&quot;,&quot;64x64x16&quot;,&quot;32x32x32&quot;,&quot;16x16x64&quot;,&quot;8x8x128&quot;,&quot;4x4x256&quot;,&quot;2x2x512&quot;,&quot;1x1x1024&quot;],&quot;y&quot;:[1.942149854,0.947873093,0.683032395,0.605635427,0.575207906,0.573205018,0.580969231,0.653116053,0.72285752,1.954330764,3.407772597],&quot;name&quot;:&quot;8 workers&quot;}],&quot;layout&quot;:{&quot;title&quot;:&quot;Benchmark results&quot;,&quot;yaxis&quot;:{&quot;title&quot;:&quot;s/op&quot;,&quot;type&quot;:&quot;log&quot;,&quot;autorange&quot;:true},&quot;shapes&quot;:[{&quot;type&quot;:&quot;line&quot;,&quot;xref&quot;:&quot;paper&quot;,&quot;yref&quot;:&quot;y&quot;,&quot;y0&quot;:3.40394218,&quot;x0&quot;:0,&quot;y1&quot;:3.40394218,&quot;x1&quot;:1,&quot;line&quot;:{&quot;width&quot;:1}},{&quot;type&quot;:&quot;line&quot;,&quot;xref&quot;:&quot;paper&quot;,&quot;yref&quot;:&quot;y&quot;,&quot;y0&quot;:1.70197109,&quot;x0&quot;:0,&quot;y1&quot;:1.70197109,&quot;x1&quot;:1,&quot;line&quot;:{&quot;width&quot;:1}},{&quot;type&quot;:&quot;line&quot;,&quot;xref&quot;:&quot;paper&quot;,&quot;yref&quot;:&quot;y&quot;,&quot;y0&quot;:1.1346473933333334,&quot;x0&quot;:0,&quot;y1&quot;:1.1346473933333334,&quot;x1&quot;:1,&quot;line&quot;:{&quot;width&quot;:1}},{&quot;type&quot;:&quot;line&quot;,&quot;xref&quot;:&quot;paper&quot;,&quot;yref&quot;:&quot;y&quot;,&quot;y0&quot;:0.850985545,&quot;x0&quot;:0,&quot;y1&quot;:0.850985545,&quot;x1&quot;:1,&quot;line&quot;:{&quot;width&quot;:1}},{&quot;type&quot;:&quot;line&quot;,&quot;xref&quot;:&quot;paper&quot;,&quot;yref&quot;:&quot;y&quot;,&quot;y0&quot;:0.680788436,&quot;x0&quot;:0,&quot;y1&quot;:0.680788436,&quot;x1&quot;:1,&quot;line&quot;:{&quot;width&quot;:1}},{&quot;type&quot;:&quot;line&quot;,&quot;xref&quot;:&quot;paper&quot;,&quot;yref&quot;:&quot;y&quot;,&quot;y0&quot;:0.5673236966666667,&quot;x0&quot;:0,&quot;y1&quot;:0.5673236966666667,&quot;x1&quot;:1,&quot;line&quot;:{&quot;width&quot;:1}}],&quot;margin&quot;:{&quot;l&quot;:25,&quot;r&quot;:5,&quot;b&quot;:75,&quot;t&quot;:50,&quot;pad&quot;:4}},&quot;config&quot;:{&quot;responsive&quot;:true}}
{{/*&lt; /plot &gt;*/}}
</code></pre>

<div class="figure">
<div class="figure-plot" id="figure1">
	Code could not finish, this are some reasons why this happen.
	- Plot name not defined. The first parameter of the shortcode is the name.
	- There is a syntax error. check browser console.
</div>
<script>
  function draw(){
	test = document.getElementById("figure1");
	if (test == null){
		console.log("The plot name is not defined")
		return
	}

	fig = null
	
fig = {"data":[{"x":["1024x1024x1","512x512x2","256x256x4","128x128x8","64x64x16","32x32x32","16x16x64","8x8x128","4x4x256","2x2x512","1x1x1024"],"y":[5.319377513,3.730183194,3.492960513,3.416568462,3.406160365,3.404795796,3.401629099,3.403963371,3.406568944,3.403851128,3.401489335],"name":"1 workers"},{"x":["1024x1024x1","512x512x2","256x256x4","128x128x8","64x64x16","32x32x32","16x16x64","8x8x128","4x4x256","2x2x512","1x1x1024"],"y":[5.105426336,2.403512541,1.769243872,1.720678808,1.705878765,1.702246865,1.705907853,1.731687894,1.819791773,1.954560985,3.404077505],"name":"2 workers"},{"x":["1024x1024x1","512x512x2","256x256x4","128x128x8","64x64x16","32x32x32","16x16x64","8x8x128","4x4x256","2x2x512","1x1x1024"],"y":[4.665434148,1.840141806,1.23159353,1.156602142,1.139298289,1.135465838,1.145931396,1.190932724,1.324346159,1.955651422,3.401555276],"name":"3 workers"},{"x":["1024x1024x1","512x512x2","256x256x4","128x128x8","64x64x16","32x32x32","16x16x64","8x8x128","4x4x256","2x2x512","1x1x1024"],"y":[3.277424857,1.508889857,1.000251994,0.877004851,0.855757891,0.851836168,0.859728354,0.902649372,1.012687753,1.955834209,3.404003372],"name":"4 workers"},{"x":["1024x1024x1","512x512x2","256x256x4","128x128x8","64x64x16","32x32x32","16x16x64","8x8x128","4x4x256","2x2x512","1x1x1024"],"y":[2.687810723,1.299930746,0.848919389,0.71687461,0.697146793,0.686797944,0.695021475,0.733307298,0.782258103,1.958691928,3.406197102],"name":"5 workers"},{"x":["1024x1024x1","512x512x2","256x256x4","128x128x8","64x64x16","32x32x32","16x16x64","8x8x128","4x4x256","2x2x512","1x1x1024"],"y":[2.419063112,1.172598442,0.770078822,0.636418239,0.59517132,0.58758251,0.598871324,0.655497364,0.722161112,1.955789037,3.40305645],"name":"6 workers"},{"x":["1024x1024x1","512x512x2","256x256x4","128x128x8","64x64x16","32x32x32","16x16x64","8x8x128","4x4x256","2x2x512","1x1x1024"],"y":[1.991583443,1.033091053,0.712726608,0.605582734,0.578420338,0.577574125,0.580463384,0.652894185,0.691949137,1.970116638,3.452580344],"name":"7 workers"},{"x":["1024x1024x1","512x512x2","256x256x4","128x128x8","64x64x16","32x32x32","16x16x64","8x8x128","4x4x256","2x2x512","1x1x1024"],"y":[1.942149854,0.947873093,0.683032395,0.605635427,0.575207906,0.573205018,0.580969231,0.653116053,0.72285752,1.954330764,3.407772597],"name":"8 workers"}],"layout":{"title":"Benchmark results","yaxis":{"title":"s/op","type":"log","autorange":true},"shapes":[{"type":"line","xref":"paper","yref":"y","y0":3.40394218,"x0":0,"y1":3.40394218,"x1":1,"line":{"width":1}},{"type":"line","xref":"paper","yref":"y","y0":1.70197109,"x0":0,"y1":1.70197109,"x1":1,"line":{"width":1}},{"type":"line","xref":"paper","yref":"y","y0":1.1346473933333334,"x0":0,"y1":1.1346473933333334,"x1":1,"line":{"width":1}},{"type":"line","xref":"paper","yref":"y","y0":0.850985545,"x0":0,"y1":0.850985545,"x1":1,"line":{"width":1}},{"type":"line","xref":"paper","yref":"y","y0":0.680788436,"x0":0,"y1":0.680788436,"x1":1,"line":{"width":1}},{"type":"line","xref":"paper","yref":"y","y0":0.5673236966666667,"x0":0,"y1":0.5673236966666667,"x1":1,"line":{"width":1}}],"margin":{"l":25,"r":5,"b":75,"t":50,"pad":4}},"config":{"responsive":true}}


	if (!fig) {
		test.innerText = "ERROR: fig variable is not defined"
		return
	}
	test.innerText = null
	Plotly.plot(test ,fig);
  }
  draw()
</script>
</div>

<p>The next howto project will be of how to setup a Python Jupyter Notebook environment to easily generate this input.</p>

<p>Just one last thing. To properly visualize the plot it is recommended to adjust the margins and enable responsive behaviour. This can be done easily appending the blocks layout and config to the figure.</p>

<pre><code class="language-js">fig = {
  &quot;data&quot;:[],
  &quot;layout&quot;:{
    &quot;margin&quot;:{&quot;l&quot;:25,&quot;r&quot;:5,&quot;b&quot;:75,&quot;t&quot;:50,&quot;pad&quot;:4}
  },
  &quot;config&quot;:{&quot;responsive&quot;:true}
}
</code></pre>

<p>Everything else is covered by the plotly docs. Take a look to it and you will find really easy to draw any plot!</p>

<h2 id="importing-plotly-js">Importing plotly.js</h2>

<p>The last important thing that must be done is to import the plotly.js file into your webpage. How to do this depends on your template. You can add the plotly.js to your custom javacript files.</p>

<p>In my case, I&rsquo;ve modified the post/single.html template, because I only need plots in posts, and included the following snippet in the headers section.</p>

<pre><code class="language-html">{{- if .Params.Plotly }}
&lt;script src=&quot;https://cdn.plot.ly/plotly-1.50.0.min.js&quot;&gt;&lt;/script&gt;
{{- end }}
</code></pre>

<p>Now, if the post contains plots, I have to add a parameter <code>plotly: true</code> and the plotly.js will be imported.</p>

<h2 id="conclusion">Conclusion</h2>

<p>This is one of the reasons I&rsquo;ve chosen Hugo for my blog is that I can do this sort of things. Customization!</p>

<h2 id="references">References</h2>

<ul>
<li><a href="https://plot.ly/javascript/">Plotly docs</a></li>
<li><a href="https://gohugo.io/content-management/shortcodes/">Hugo sortcodes</a></li>
</ul></article><section class="article labels"><a class="category" href=/categories/howto/>howto</a><a class="tag" href=/tags/plotly/>plotly</a><a class="tag" href=/tags/hugo/>hugo</a></section></div><section class="article navigation"><p><a class="link" href="/post/howto/2019-12-01_python_jupyter_notebook_with_plotly_support/"><span class="li">&larr;</span>Python Jupyter Notebook With Plotly Support</a></p><p><a class="link" href="/post/blog/2019-12-02_weekend_learnings/"><span class="li">&rarr;</span>2019-12-02 Weekend Learnings</a></p></section><script src="https://utteranc.es/client.js" repo="MetalBlueberry/MetalBlueberry.github.io" issue-term="og:title"
    label="comment" theme="github-light" crossorigin="anonymous" async>
    </script></div><section id="footer" class="footer"><div class="footer-wrap">
    <p class="copyright">Víctor Pérez Domingo</p>
    <p class="powerby"><span>Powered by </span><a href="https://gohugo.io" 
        target="_blank">Hugo</a><span> and the </span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank">Notepadium</a></p>
</div></section>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-150427130-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</div>
</body>

</html>