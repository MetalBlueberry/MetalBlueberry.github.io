<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.59.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>2020-03-30 Weekend Learnings&nbsp;&ndash;&nbsp;MetalBlueberry</title><link rel="stylesheet" href="/css/core.min.97dca4f10b4a76a5c62d6c5855e9eaab3b083ba20b6e4059f24dc20a8bb331c418ecdfd5449a29ef5333ebc2c64b286b.css" integrity="sha384-l9yk8QtKdqXGLWxYVenqqzsIO6ILbkBZ8k3CCouzMcQY7N/VRJop71Mz68LGSyhr"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="2020-03-30 Weekend Learnings"/>
<meta name="twitter:description" content="I&rsquo;ve learned a little bit about frontend testing with chromium web drivers using Agouti and It has proven to be a really good option to write test in Go. Also we are in quarantine so I let you here a WebGL interactive animation to entertain you."/>

<meta property="og:title" content="2020-03-30 Weekend Learnings" />
<meta property="og:description" content="I&rsquo;ve learned a little bit about frontend testing with chromium web drivers using Agouti and It has proven to be a really good option to write test in Go. Also we are in quarantine so I let you here a WebGL interactive animation to entertain you." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://metalblueberry.github.io/post/blog/2020-03-30-weekend_learnings/" />
<meta property="article:published_time" content="2020-03-31T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-04-10T11:35:19+02:00" />

<meta name="author" content="MetalBlueberry">
<body>
    <div class="base-body"><section id="header" class="site header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><img class="site logo" src="/android-chrome-512x512.png" alt /><span class="site name">MetalBlueberry</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/about">About</a><a class="nav item" href="/social">Follow me</a></nav></div></span></div><div class="site slogan"><span class="title">A passionate programmer</span></div></section><div id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">2020-03-30 Weekend Learnings</h1><p class="article date">Tuesday, March 31, 2020<span class="lastmod"> • edited Friday, April 10, 2020</span></p></section><article class="article markdown-body"><p>I&rsquo;ve learned a little bit about frontend testing with chromium web drivers using <a href="https://agouti.org/">Agouti</a> and It has proven to be a really good option to write test in Go. Also we are in quarantine so I let you here a WebGL interactive animation to entertain you.</p>

<h2 id="enjoy">Enjoy</h2>

<p><iframe src="https://paveldogreat.github.io/WebGL-Fluid-Simulation/" style="width:100%; height:800px; border:none;"></iframe></p>

<h2 id="agouti">Agouti</h2>

<p><a href="https://agouti.org/">Agouti</a> is an universal WebDriver client for Go. I decided to use it because I&rsquo;m already familiar with Ginkgo and Gomega and I think that it covers my use case, Which is testing simple web applications and APIs from the same code.</p>

<p>You can get started with the Ginkgo cli by running the bootstrap command with the &ndash;agouti flag</p>

<pre><code class="language-bash">ginkgo bootstrap --agouti  
</code></pre>

<p>This generates a bootstrap file with the following structure</p>

<pre><code class="language-go">package Agouti_test

import (
	&quot;testing&quot;

	. &quot;github.com/onsi/ginkgo&quot;
	. &quot;github.com/onsi/gomega&quot;
	&quot;github.com/sclevine/agouti&quot;
)

func TestAgouti(t *testing.T) {
	RegisterFailHandler(Fail)
	RunSpecs(t, &quot;Agouti Suite&quot;)
}

var agoutiDriver *agouti.WebDriver

var _ = BeforeSuite(func() {
	// Choose a WebDriver:

	// agoutiDriver = agouti.PhantomJS()
	// agoutiDriver = agouti.Selenium()
	agoutiDriver = agouti.ChromeDriver()

	Expect(agoutiDriver.Start()).To(Succeed())
})

var _ = AfterSuite(func() {
	Expect(agoutiDriver.Stop()).To(Succeed())
})

</code></pre>

<p>If you are familiar with Ginkgo, you will recognise everything in this file. It&rsquo;s self explanatory. You have to pay attention to the selected web driver. From my experience, ChromeDriver works well. I do not recommend <strong>PhantomJS as it is deprecated</strong>.</p>

<p>Now you are ready to start writing your own browser tests. Following the example in the official page, you can create the structure using ginkgo cli.</p>

<pre><code class="language-bash">ginkgo generate --agouti user_login
</code></pre>

<pre><code class="language-go">package Agouti_test

import (
	. &quot;github.com/onsi/ginkgo&quot;
	. &quot;github.com/onsi/gomega&quot;
	&quot;github.com/sclevine/agouti&quot;
	. &quot;github.com/sclevine/agouti/matchers&quot;

	. &quot;UNKNOWN_PACKAGE_PATH&quot;
)

var _ = Describe(&quot;UserLogin&quot;, func() {
	var page *agouti.Page

	BeforeEach(func() {
		var err error
		page, err = agoutiDriver.NewPage()
		Expect(err).NotTo(HaveOccurred())
	})

	AfterEach(func() {
		Expect(page.Destroy()).To(Succeed())
	})
})
</code></pre>

<p>I&rsquo;m not going to copy an paste everything from that page here. Just go to <a href="https://agouti.org/">Agouti</a> webpage and read the tutorial.</p>

<h2 id="genereate-a-portable-binary-test">Genereate a portable binary test</h2>

<p>This is the main reason why I&rsquo;ve chosen Go for writing test. I need to be able to write test and share them with other developers to execute it in their local environment. If you&rsquo;ve tried to share applications in Python, Java or other programming languages that require heavy environment setup, it&rsquo;s always annoying. With go, just give execution permissions and you are ready to Go.</p>

<p>To generate a binary from the current tests, you have to run the following command</p>

<pre><code class="language-bash">go test -c
#or
ginkgo build
</code></pre>

<p>This will generate a binary file, in my case Agouti.test, that you can run to have the same effect as running go test.</p>

<pre><code class="language-bash">./Agouti.test
</code></pre>

<p>There is one missing feature for being able to really use this approach. Flags! You can easily add your own flags using the <code>init()</code> function. Here is an example of a flag to select the driver. You can easily extend this to add your own flags. The trick is to define all the flags in the <code>init()</code> section. Note that we are not calling <code>flag.Parse</code> because it is internally called.</p>

<pre><code class="language-go">
(...)

var driverName string

func init() {
	flag.StringVar(&amp;driverName, &quot;driver&quot;, &quot;chromedriver&quot;, &quot;The driver to be used&quot;)
}

(...)

var _ = BeforeSuite(func() {

	// Choose a WebDriver:
	switch driverName {
	case &quot;chromedriver&quot;:
		agoutiDriver = agouti.ChromeDriver()
	case &quot;selenium&quot;:
		agoutiDriver = agouti.Selenium()
  default:
		Fail(&quot;Invalid driver&quot;)
	}

	Expect(agoutiDriver.Start()).To(Succeed())
})

(...)
</code></pre>

<p>Now you can run ginkgo with flags or the binary generated</p>

<pre><code class="language-bash">ginkgo -- --driver selenium
./Agouti.test --driver selenium
</code></pre>

<p>If you start the <code>Agouti.test</code> with &ndash;help. you will find that all the ginkgo/test flags are still there. Therefore you can do interesting things such as focus specs by pattern, enable verbose output or enabling fail fast.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Go + Ginkgo + Gomega + Agouti are perfect to write portable test suites that can be executed in any system. The next steps will be to add some API testing directly with Go http library and to try Agouti inside a docker container. I think that the docker container will just work inside this image <a href="https://hub.docker.com/r/robcherry/docker-chromedriver/">https://hub.docker.com/r/robcherry/docker-chromedriver/</a></p>

<h2 id="references">References</h2>

<ul>
<li><a href="https://agouti.org/">Agouti</a></li>
<li><a href="https://github.com/PavelDoGreat/WebGL-Fluid-Simulation">Fluid simulation</a></li>
</ul></article><section class="article labels"><a class="category" href=/categories/blog/>blog</a><a class="tag" href=/tags/weekend/>weekend</a><a class="tag" href=/tags/testing/>testing</a><a class="tag" href=/tags/go/>go</a></section></div><section class="article navigation"><p><a class="link" href="/post/blog/2020-04-06_coronavirus_trend_in_spain/"><span class="li">&larr;</span>Coronavirus Trend In Spain</a></p><p><a class="link" href="/post/howto/2020-03-11_use_git_to_track_git_versions/"><span class="li">&rarr;</span>Use Git to track Git versions</a></p></section><script src="https://utteranc.es/client.js" repo="MetalBlueberry/MetalBlueberry.github.io" issue-term="og:title"
    label="comment" theme="github-light" crossorigin="anonymous" async>
    </script></div><section id="footer" class="footer"><div class="footer-wrap">
    <p class="copyright">Víctor Pérez Domingo</p>
    <p class="powerby"><span>Powered by </span><a href="https://gohugo.io" 
        target="_blank">Hugo</a><span> and the </span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank">Notepadium</a></p>
</div></section>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-150427130-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</div>
</body>

</html>